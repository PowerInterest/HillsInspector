{% set liens = tax.liens or [] %}
{% set flr_liens = tax.flr_liens or [] %}

<section class="card">
    <h2>Tax Status</h2>
    <div class="info-grid">
        <div class="info-item">
            <span class="info-label">Tax Status</span>
            <span class="info-value">{{ tax.tax_status or 'Unknown' }}</span>
        </div>
        <div class="info-item">
            <span class="info-label">Tax Warrant</span>
            <span class="info-value">
                {% if tax.tax_warrant %}Yes{% else %}No{% endif %}
            </span>
        </div>
        <div class="info-item">
            <span class="info-label">Has Tax Liens</span>
            <span class="info-value">
                {% if tax.has_tax_liens %}Yes{% else %}No{% endif %}
            </span>
        </div>
        <div class="info-item">
            <span class="info-label">Total Amount Due</span>
            <span class="info-value money">
                {{ "${:,.2f}".format(tax.total_amount_due) if tax.total_amount_due else "-" }}
            </span>
        </div>
    </div>
</section>

<section class="card">
    <h2>Tax-Related Encumbrances</h2>
    {% if liens %}
    <div class="table-container">
        <table class="data-table">
            <thead>
                <tr>
                    <th>Date</th>
                    <th>Type</th>
                    <th>Amount</th>
                    <th>Creditor</th>
                    <th>Status</th>
                </tr>
            </thead>
            <tbody>
                {% for lien in liens %}
                <tr>
                    <td>{{ lien.recording_date|format_date if lien.recording_date else "-" }}</td>
                    <td>{{ lien.encumbrance_type or "-" }}</td>
                    <td class="money">{{ "${:,.2f}".format(lien.amount) if lien.amount else "-" }}</td>
                    <td>{{ lien.creditor or "-" }}</td>
                    <td>{{ lien.survival_status or "-" }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    {% else %}
    <p class="muted">No tax-related encumbrance records found.</p>
    {% endif %}
</section>

<section class="card">
    <h2>Federal Lien Registry (Sunbiz)</h2>
    {% if flr_liens %}
    <div class="table-container">
        <table class="data-table">
            <thead>
                <tr>
                    <th>Filing Date</th>
                    <th>Doc Number</th>
                    <th>Debtor</th>
                    <th>Secured Party</th>
                    <th>Match</th>
                </tr>
            </thead>
            <tbody>
                {% for fl in flr_liens %}
                <tr>
                    <td>{{ fl.filing_date|format_date if fl.filing_date else "-" }}</td>
                    <td>{{ fl.doc_number or "-" }}</td>
                    <td>{{ fl.debtor_name or "-" }}</td>
                    <td>{{ fl.secured_party or "-" }}</td>
                    <td>{{ "{:.0f}%".format(fl.similarity_score * 100) if fl.similarity_score else "-" }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    {% else %}
    <p class="muted">No federal lien filings found for this owner.</p>
    {% endif %}
</section>

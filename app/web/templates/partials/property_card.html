<!-- Property Card - Auction.com Style with Enrichments -->
{% set enrich = auction.enrichments or {} %}
{% set flood_zone = enrich.flood_zone | default('') %}
{% set flood_risk = enrich.flood_risk | default('') %}
{% set insurance_required = enrich.insurance_required | default(false) %}
{% set permits_open = enrich.permits_open | default(0) %}
{% set permits_total = enrich.permits_total | default(0) %}
{% set liens_survived = enrich.liens_survived | default(0) %}
{% set liens_uncertain = enrich.liens_uncertain | default(0) %}
{% set liens_surviving = enrich.liens_surviving | default(0) %}
{% set liens_total_amount = enrich.liens_total_amount | default(0) %}
{% set liens_total = enrich.liens_total | default(0) %}
{% set has_enrichments = enrich.has_enrichments | default(false) %}

<div class="property-card {% if auction.is_toxic_title %}toxic{% endif %}" data-folio="{{ auction.folio }}">
    <!-- Photo / Placeholder -->
    <div class="card-image">
        {% if auction.photo_url %}
        <img src="{{ auction.photo_url }}" alt="{{ auction.property_address }}" loading="lazy">
        {% else %}
        <div class="card-image-placeholder">
            <span class="placeholder-icon">üè†</span>
            <span class="placeholder-text">No Photo</span>
        </div>
        {% endif %}

        <!-- Auction Type Badge -->
        <div class="card-type-badge badge-{{ auction.auction_type|lower }}">
            {{ 'Foreclosure' if auction.auction_type == 'FORECLOSURE' else 'Tax Deed' }}
        </div>

        <!-- Quick Actions -->
        <div class="card-actions">
            <button class="action-btn" title="Save for later">
                <span>‚òÜ</span>
            </button>
        </div>
        </div>

    <!-- Enrichment Badges Row -->
    <div class="enrichment-badges">
        <!-- Flood Zone -->
        {% if flood_zone %}
        <span class="badge-enrichment badge-flood-{{ 'high' if insurance_required else 'low' }}"
              title="{{ flood_risk or 'Flood Zone' }}">
            üåä {{ flood_zone }}
        </span>
        {% endif %}

        <!-- Open Permits -->
        {% if permits_open > 0 %}
        <span class="badge-enrichment badge-permits-open" title="{{ permits_open }} open permits">
            üî® {{ permits_open }} Open
        </span>
        {% elif permits_total > 0 %}
        <span class="badge-enrichment badge-permits-clear" title="All {{ permits_total }} permits closed">
            ‚úì Permits
        </span>
        {% endif %}

        <!-- Encumbrances / Liens -->
        {% if liens_surviving > 0 %}
        <span class="badge-enrichment badge-liens" title="{{ liens_total }} encumbrances, {{ liens_survived }} survived, {{ liens_uncertain }} uncertain">
            {% if liens_survived > 0 and liens_uncertain > 0 %}
            ‚ö†Ô∏è {{ liens_survived }} Survived + {{ liens_uncertain }} Uncertain
            {% elif liens_survived > 0 %}
            ‚ö†Ô∏è {{ liens_survived }} Survived
            {% else %}
            ‚ö†Ô∏è {{ liens_uncertain }} Uncertain
            {% endif %}
        </span>
        {% elif liens_total > 0 %}
        <span class="badge-enrichment badge-liens-clear" title="{{ liens_total }} encumbrances analyzed, none surviving">
            ‚úì {{ liens_total }} Liens
        </span>
        {% endif %}

        <!-- Toxic Title -->
        {% if auction.is_toxic_title %}
        <span class="badge-enrichment badge-toxic" title="Title issues detected">
            ‚ò†Ô∏è Toxic
        </span>
        {% endif %}

        <!-- Clear Title (if analyzed and no issues) -->
        {% if has_enrichments and not auction.is_toxic_title and liens_surviving == 0 and liens_total > 0 %}
        <span class="badge-enrichment badge-clear" title="No title issues found">
            ‚úì Clear
        </span>
        {% endif %}
    </div>

    <!-- Card Body -->
    <div class="card-body">
        <!-- Price -->
        <div class="card-price">
            {% if auction.opening_bid %}
            <span class="price-amount">${{ "{:,.0f}".format(auction.opening_bid) }}</span>
            <span class="price-label">Opening Bid</span>
            {% elif auction.final_judgment_amount %}
            <span class="price-amount">${{ "{:,.0f}".format(auction.final_judgment_amount) }}</span>
            <span class="price-label">Judgment</span>
            {% else %}
            <span class="price-amount">TBD</span>
            <span class="price-label">Opening Bid</span>
            {% endif %}
        </div>

        <!-- Address -->
        <div class="card-address">
            <a href="/property/{{ auction.folio or auction.case_number }}">
                {{ auction.property_address or 'Address Not Available' }}
            </a>
        </div>

        <!-- Property Details -->
        <div class="card-details">
            {% if auction.beds %}
            <span class="detail-item">{{ auction.beds|int }} bd</span>
            <span class="detail-sep">|</span>
            {% endif %}
            {% if auction.baths %}
            <span class="detail-item">{{ auction.baths }} ba</span>
            <span class="detail-sep">|</span>
            {% endif %}
            {% if auction.heated_area %}
            <span class="detail-item">{{ "{:,.0f}".format(auction.heated_area) }} sqft</span>
            {% endif %}
            {% if auction.year_built %}
            <span class="detail-sep">|</span>
            <span class="detail-item">{{ auction.year_built|int }}</span>
            {% endif %}
        </div>

        <!-- Divider -->
        <div class="card-divider"></div>

        <!-- Financial Summary -->
        <div class="card-financials">
            <div class="financial-row">
                <span class="financial-label">Assessed:</span>
                <span class="financial-value">{{ "${:,.0f}".format(auction.assessed_value) if auction.assessed_value else '-' }}</span>
            </div>
            <div class="financial-row">
                <span class="financial-label">Judgment:</span>
                <span class="financial-value">{{ "${:,.0f}".format(auction.final_judgment_amount) if auction.final_judgment_amount else '-' }}</span>
            </div>
            <div class="financial-row equity-row">
                <span class="financial-label">Est. Equity:</span>
                <span class="financial-value {% if auction.net_equity and auction.net_equity > 0 %}positive{% elif auction.net_equity and auction.net_equity < 0 %}negative{% endif %}">
                    {% if auction.net_equity %}
                    {{ "${:+,.0f}".format(auction.net_equity) }}
                    {% else %}
                    -
                    {% endif %}
                </span>
            </div>
        </div>

        <!-- Auction Date -->
        <div class="card-auction-date">
            <span class="auction-date-icon">üìÖ</span>
            <span class="auction-date-text">
                {{ auction.auction_date|format_date if auction.auction_date else 'Date TBD' }}
            </span>
        </div>

        <!-- View Details Button -->
        <a href="/property/{{ auction.case_number or auction.folio }}" class="card-button">
            View Details
        </a>
    </div>
</div>

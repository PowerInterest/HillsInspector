{% if sales %}
<div class="sales-history-list">
    {% for sale in sales %}
    <div class="sale-item">
        <div class="sale-header">
            <span class="sale-date">{{ sale.sale_date or 'Unknown Date' }}</span>
            <span class="badge {% if sale.doc_type == 'WD' %}badge-info{% elif sale.doc_type == 'CT' %}badge-warning{% elif sale.doc_type == 'FD' %}badge-danger{% else %}badge-secondary{% endif %}">
                {{ sale.doc_type or 'N/A' }}
            </span>
        </div>
        <div class="sale-details">
            <div class="sale-price">
                {% if sale.sale_price %}
                ${{ "{:,.0f}".format(sale.sale_price) }}
                {% else %}
                <span class="text-muted">No price recorded</span>
                {% endif %}
            </div>
            <div class="sale-meta">
                {% if sale.book and sale.page and sale.book != 'None' and sale.page != 'None' %}
                <span class="sale-ref">Bk {{ sale.book }} / Pg {{ sale.page }}</span>
                {% endif %}
                {% if sale.instrument %}
                <span class="sale-instrument">Inst: {{ sale.instrument }}</span>
                {% endif %}
            </div>
        </div>
        <div class="sale-actions">
            {% if sale.ori_link %}
            <a href="{{ sale.ori_link }}" target="_blank" class="btn btn-sm btn-outline">View Deed</a>
            {% elif sale.book and sale.page and sale.book != 'None' and sale.page != 'None' %}
            <a href="https://publicaccess.hillsclerk.com/PAVDirectSearch/index.html?CQID=319&OBKey__1530_1=O&OBKey__573_1={{ sale.book }}&OBKey__1049_1={{ sale.page }}" target="_blank" class="btn btn-sm btn-outline">ORI Lookup</a>
            {% elif sale.instrument %}
            <a href="https://publicaccess.hillsclerk.com/PAVDirectSearch/index.html?CQID=319&OBKey__1530_1=O&OBKey__1528_1={{ sale.instrument }}" target="_blank" class="btn btn-sm btn-outline">ORI Lookup</a>
            {% endif %}
        </div>
    </div>
    {% endfor %}
</div>
<div class="doc-type-legend">
    <small>
        <span class="badge badge-info">WD</span> Warranty Deed
        <span class="badge badge-warning">CT</span> Certificate of Title
        <span class="badge badge-danger">FD</span> Final Deed
        <span class="badge badge-secondary">QC</span> Quit Claim
    </small>
</div>
{% else %}
<p class="empty-state">No sales history found.</p>
{% endif %}

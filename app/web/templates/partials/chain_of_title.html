<div class="timeline-container">
    {% if not chain_of_title %}
        <div class="no-data">
            <p>No chain of title data is available for this property.</p>
        </div>
    {% else %}
        <ul class="timeline">
            {% for transfer in chain_of_title %}
                {% set is_break = false %}
                {% if not loop.first %}
                    {% set prev_transfer = chain_of_title[loop.index0 - 1] %}
                    {% if transfer.owner_name and prev_transfer.acquired_from and transfer.owner_name|lower != prev_transfer.acquired_from|lower %}
                        {% set is_break = true %}
                    {% endif %}
                {% endif %}

                {% if is_break %}
                <li class="timeline-break">
                    <div class="break-icon"></div>
                    <div class="break-line"></div>
                    <div class="break-text">Potential break in chain</div>
                </li>
                {% endif %}

                <li class="timeline-item">
                    <div class="timeline-dot"></div>
                    <div class="timeline-content">
                        <div class="timeline-date">{{ transfer.acquisition_date }}</div>
                        <div class="timeline-title">
                            <strong>{{ transfer.owner_name or 'Unknown' }}</strong>
                            <span class="timeline-subtitle">acquired from {{ transfer.acquired_from or 'Unknown' }}</span>
                        </div>
                        <div class="timeline-body">
                            <p>
                                <strong>Document:</strong> {{ transfer.acquisition_doc_type }} ({{ transfer.acquisition_instrument }})
                                {% if transfer.document_id %}
                                    <a href="/property/{{ folio }}/doc/{{ transfer.document_id }}" target="_blank" class="doc-link">View Doc</a>
                                {% endif %}
                            </p>
                            <p>
                                <strong>Price:</strong>
                                {% if transfer.acquisition_price %}
                                    ${{ "{:,.0f}".format(transfer.acquisition_price) }}
                                {% else %}
                                    -
                                {% endif %}
                            </p>
                        </div>
                    </div>
                </li>
            {% endfor %}
             <li class="timeline-item timeline-start">
                <div class="timeline-dot"></div>
                <div class="timeline-content">
                    <div class="timeline-title">Chain begins</div>
                </div>
            </li>
        </ul>
    {% endif %}
</div>